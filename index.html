<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
:root {
    --hex: 84px;
}

body {
    margin: 0;
    background: radial-gradient(circle at center, #0b0b0b, #050505);
    font-family: system-ui;
    color: #bbb;
    overflow-x: hidden;
}

#app {
    max-width: 1300px;
    margin: auto;
    padding: 20px 20px 160px;
}

#stats {
    text-align: center;
    font-size: 18px;
    margin-bottom: 12px;
    color: #eee;
}

#grid {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: calc(var(--hex) * -0.25);
    transition: 0.4s;
}

.row {
    display: flex;
    gap: calc(var(--hex) * 0.08);
}

.row.offset {
    margin-left: calc(var(--hex) * 0.52);
}

/* True regular hexagon */
.hex {
    width: var(--hex);
    aspect-ratio: 1 / 1.1547;
    background: #2a2a2a;
    clip-path: polygon(
        25% 6.7%, 75% 6.7%,
        100% 50%,
        75% 93.3%, 25% 93.3%,
        0% 50%
    );
    border-radius: 10%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: 
        background 0.3s,
        transform 0.25s,
        box-shadow 0.3s;
    position: relative;
}

.hex:hover {
    transform: scale(1.04);
}

/* States */
.hex.green { background: #1f7f50; color: #eafff4; }
.hex.red { background: #7f1f1f; color: #ffe5e5; }
.hex.yellow { background: #7f7320; color: #fff6c8; }

/* Today glow */
.hex.today {
    box-shadow:
        0 0 14px rgba(255,255,255,0.8),
        0 0 40px rgba(255,255,255,0.4);
}

/* Locked */
.hex.locked {
    opacity: 0.6;
}

/* Controls */
#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #0d0d0d;
    padding: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    box-shadow: 0 -10px 25px rgba(0,0,0,0.8);
}

button, input {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 14px;
    border-radius: 6px;
}

button:hover {
    background: #333;
}

input[type=number] {
    width: 80px;
}
</style>
</head>

<body>
<div id="app">
    <div id="stats">Max streak: <span id="streak">0</span></div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>

    <button id="overrideBtn">Override: OFF</button>

    <label>Days
        <input id="daysSlider" type="range" min="14" max="365" value="60">
    </label>
    <input id="daysInput" type="number" min="1" max="365" value="60">
</div>

<script>
const storeKey = "hexData";
let data = JSON.parse(localStorage.getItem(storeKey) || "{}");

let override = false;
let selected = null;
let days = 60;

const slider = document.getElementById("daysSlider");
const numberInput = document.getElementById("daysInput");

slider.oninput = () => {
    days = +slider.value;
    numberInput.value = days;
    render();
};

numberInput.onchange = () => {
    days = Math.min(365, Math.max(1, +numberInput.value || 1));
    slider.value = days;
    render();
};

document.getElementById("overrideBtn").onclick = () => {
    override = !override;
    document.getElementById("overrideBtn").innerText = override ? "Override: ON" : "Override: OFF";
};

function today() {
    return new Date().toISOString().split("T")[0];
}

function datePlus(n) {
    const d = new Date();
    d.setDate(d.getDate() + n);
    return d;
}

function key(d) {
    return d.toISOString().split("T")[0];
}

function setDay(color) {
    if (!selected) return;
    const k = key(selected);
    if (!override && k !== today()) return;
    data[k] = color;
    localStorage.setItem(storeKey, JSON.stringify(data));
    render();
}

/* Max streak */
function calcMaxStreak() {
    let max = 0, cur = 0, last = null;
    Object.keys(data).sort().forEach(k => {
        if (data[k] === "green") {
            if (last) {
                const diff = (new Date(k) - new Date(last)) / 86400000;
                cur = diff === 1 ? cur + 1 : 1;
            } else cur = 1;
            max = Math.max(max, cur);
            last = k;
        }
    });
    return max;
}

/* Mouse reactive glow */
document.addEventListener("mousemove", e => {
    const x = e.clientX / window.innerWidth * 100;
    const y = e.clientY / window.innerHeight * 100;
    document.body.style.background =
        `radial-gradient(circle at ${x}% ${y}%, #101010, #050505)`;
});

function render() {
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    const size = Math.max(36, 90 - days * 0.12);
    document.documentElement.style.setProperty("--hex", size + "px");

    let index = 0;
    for (let r = 0; index < days; r++) {
        const row = document.createElement("div");
        row.className = "row" + (r % 2 ? " offset" : "");

        for (let c = 0; c < 9 && index < days; c++) {
            const d = datePlus(index);
            const k = key(d);

            const hex = document.createElement("div");
            hex.className = "hex";

            if (data[k]) hex.classList.add(data[k]);
            if (k === today()) hex.classList.add("today");
            if (!override && k !== today()) hex.classList.add("locked");

            hex.textContent = d.toLocaleDateString(undefined, {month:"short", day:"numeric"});

            hex.onclick = () => {
                selected = d;
                document.querySelectorAll(".hex").forEach(h => h.style.outline = "");
                hex.style.outline = "2px solid white";
            };

            row.appendChild(hex);
            index++;
        }
        grid.appendChild(row);
    }

    document.getElementById("streak").textContent = calcMaxStreak();
}

render();
</script>
</body>
</html>
