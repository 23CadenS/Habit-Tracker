<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>
<style>
/* 8-bit font */
@import url('https://fonts.cdnfonts.com/css/press-start-2p');

:root { --hex-size: 86px; }

body {
  margin:0;
  background:#050505;
  font-family: 'Press Start 2P', cursive;
  color:#ddd;
  overflow-x:hidden;
}

canvas { position:fixed; inset:0; z-index:0; }

#app { position:relative; z-index:2; padding:20px 20px 220px; max-width:1400px; margin:auto; }
#stats { text-align:center; margin-bottom:16px; font-size:16px; }
#grid { position:relative; margin:auto; transition: transform 0.15s ease-out; }

.hex {
  position:absolute; width:var(--hex-size); height:calc(var(--hex-size)*0.866);
  background:#3b2b5f; /* purple tint for unchecked */
  clip-path:polygon(26% 3%,74% 3%,97% 50%,74% 97%,26% 97%,3% 50%);
  border-radius:30%;
  display:flex; align-items:center; justify-content:center;
  font-size:10px; color:#e0e0e0; cursor:pointer;
  box-shadow:0 0 0 1.4px rgba(255,255,255,0.75),0 0 12px rgba(255,255,255,0.55),0 0 26px rgba(255,255,255,0.25),inset 0 0 10px rgba(255,255,255,0.18);
  transition: transform 0.15s cubic-bezier(.2,1.4,.4,1), box-shadow 0.15s cubic-bezier(.2,1.4,.4,1), background 0.15s;
}
.hex.hoverable:hover {
  transform: scale(1.15);
  box-shadow:0 0 0 1.8px rgba(255,255,255,1),0 0 26px rgba(255,255,255,1),0 0 60px rgba(255,255,255,0.6),inset 0 0 18px rgba(255,255,255,0.35);
  z-index:5;
}

.green { background:#1f7f50; box-shadow:0 0 0 1.6px rgba(220,255,235,1),0 0 24px rgba(90,255,200,0.85),0 0 60px rgba(60,200,150,0.55);}
.red { background:#7f1f1f; box-shadow:0 0 0 1.6px rgba(255,220,220,1),0 0 24px rgba(255,90,90,0.85),0 0 60px rgba(200,60,60,0.55);}
.yellow { background:#7f7320; box-shadow:0 0 0 1.6px rgba(255,245,200,1),0 0 24px rgba(255,230,130,0.9),0 0 60px rgba(200,180,70,0.55);}
.today { box-shadow:0 0 0 2.2px white,0 0 34px rgba(255,255,255,1),0 0 80px rgba(255,255,255,0.9),0 0 140px rgba(255,255,255,0.5);}
.locked { opacity:0.55; }

/* Controls */
#controls {
  position:fixed; bottom:0; inset-inline:0; background:#0d0d0d; padding:14px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
  box-shadow:0 -10px 30px rgba(0,0,0,0.9); z-index:3;
}
button,input { background:#222; border:none; color:#ddd; padding:10px 14px; border-radius:6px; font-size:14px; font-family: 'Press Start 2P', cursive; }
button:hover { background:#333; }
input[type=number]{ width:60px; border-radius:6px; }

/* GitHub token */
#loginBtn {
  position:fixed; bottom:12px; left:12px; z-index:9999; padding:8px 10px; background:#111; color:#fff; border-radius:10px; display:flex; gap:4px;
}
#loginBtn input { width:140px; background:#000; color:#fff; padding:6px; border:1px solid #444; border-radius:6px; font-size:10px; }

/* Slider style */
input[type=range] {
  -webkit-appearance:none; width:150px; height:6px; background:#444; border-radius:3px; outline:none;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance:none; height:18px; width:18px; border-radius:50%; background:#fff; cursor:pointer; box-shadow:0 0 2px #fff;
}
input[type=range]::-moz-range-thumb { height:18px; width:18px; border-radius:50%; background:#fff; cursor:pointer; }

/* Saving indicator */
#syncStatus { position:fixed; bottom:12px; right:12px; font-size:12px; color:#fff; font-family:sans-serif; z-index:9999; }
#animToggle { position:fixed; bottom:180px; left:12px; z-index:9999; color:#fff; font-family:sans-serif; }
</style>
</head>
<body>
<canvas id="particles"></canvas>

<div id="app">
  <div id="stats">
    Max streak: <span id="maxStreak">0</span> | Current streak: <span id="curStreak">0</span>
  </div>
  <div id="grid"></div>
</div>

<div id="controls">
  <button onclick="setDay('green')">Green</button>
  <button onclick="setDay('yellow')">Yellow</button>
  <button onclick="setDay('red')">Red</button>
  <button id="grayBtn" onclick="setDay(null)">Gray</button>
  <button id="overrideBtn">Override: OFF</button>
  <label>Days <input id="daysSlider" type="range" min="14" max="500"></label>
  <input id="daysInput" type="number" min="1" max="500">
</div>

<div id="loginBtn">
  <input id="ghToken" type="password" placeholder="GitHub Token">
  <button onclick="saveToken()">Connect</button>
</div>

<div id="syncStatus">Not connected</div>
<div id="animToggle">
  <label>Animations <input type="checkbox" id="animSwitch"></label>
</div>

<script>
/* CORE DATA */
let storeKey="hexData", autoKey="hexAutoDays", data=JSON.parse(localStorage.getItem(storeKey)||"{}"), override=false, selected=null, saving=false;

/* TODAY/DATE */
const today=()=>new Date().toISOString().split("T")[0];
const datePlus=n=>{const d=new Date();d.setDate(d.getDate()+n);return d;}
const key=d=>d.toISOString().split("T")[0];

/* AUTO DAYS */
function getAutoDays(){
  const t=today();
  let s=JSON.parse(localStorage.getItem(autoKey)||"{}");
  if(!s.date) s={date:t,days:60};
  const diff=(new Date(t)-new Date(s.date))/86400000;
  if(diff>0){s.days+=diff;s.date=t;}
  localStorage.setItem(autoKey,JSON.stringify(s));
  return s.days;
}
let days=getAutoDays();
daysSlider.value=daysInput.value=days;
daysSlider.oninput=()=>{days=+daysSlider.value;daysInput.value=days;render();}
daysInput.onchange=()=>{days=Math.min(500,Math.max(1,+daysInput.value||1));daysSlider.value=days;render();}

/* OVERRIDE */
overrideBtn.onclick=()=>{ override=!override; overrideBtn.textContent=override?"Override: ON":"Override: OFF"; grayBtn.style.display=override?"inline-block":"none"; }

/* STREAK CALC */
function calcStreaks(){
  let max=0,cur=0,prev=null;
  Object.keys(data).sort().forEach(k=>{
      if(data[k]==="green"){ cur=prev&&(new Date(k)-new Date(prev)===86400000)?cur+1:1; max=Math.max(max,cur); prev=k; }
  });
  let run=0;
  for(let i=0;;i--){ const k=key(datePlus(i)); if(data[k]==="green") run++; else break; }
  return {max,cur:run};
}

/* ANIMATIONS */
let animEnabled=localStorage.getItem("animEnabled")!=="false";
const animSwitch=document.getElementById("animSwitch");
animSwitch.checked=animEnabled;
animSwitch.onchange=()=>{animEnabled=animSwitch.checked; localStorage.setItem("animEnabled",animEnabled);}

/* RENDER GRID */
function render(){
  grid.innerHTML="";
  const size=Math.max(36,96-days*0.12);
  document.documentElement.style.setProperty("--hex-size",size+"px");
  const w=size,h=size*0.866,gap=w*0.78;
  const rows=Math.max(6,Math.floor((innerHeight-260)/h));
  for(let i=0;i<days;i++){
    const col=Math.floor(i/rows),row=i%rows;
    const d=datePlus(i),k=key(d);
    const hex=document.createElement("div");
    hex.className="hex";
    if(animEnabled) hex.classList.add("hoverable");
    if(data[k]) hex.classList.add(data[k]);
    if(k===today()){ hex.classList.add("today"); selected=d; }
    if(!override && k!==today()) hex.classList.add("locked");
    hex.textContent=d.toLocaleDateString(undefined,{month:"short",day:"numeric"});
    hex.style.left=(col*gap)+"px";
    hex.style.top=(row*h+(col%2?h/2:0))+"px";
    hex.onclick=()=>selected=d;
    grid.appendChild(hex);
  }
  grid.style.width=(Math.ceil(days/rows)*gap+w)+"px";
  grid.style.height=(rows*h+h)+"px";
  const s=calcStreaks(); maxStreak.textContent=s.max; curStreak.textContent=s.cur;
}
render(); onresize=render;

/* PARTICLES */
const ctx=particles.getContext("2d");
function resize(){particles.width=innerWidth;particles.height=innerHeight;}
resize(); onresize=resize;

const parts=[...Array(100)].map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2+.5,v:Math.random()*.25+.1}));
(function anim(){
  if(animEnabled){
    ctx.clearRect(0,0,particles.width,particles.height); ctx.fillStyle="rgba(255,255,255,.18)";
    parts.forEach(p=>{p.y-=p.v;if(p.y<0)p.y=particles.height; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();});
  }
  if(animEnabled) grid.style.transform=`translate(${(event?.clientX||innerWidth/2)/innerWidth-.5*16}px,${(event?.clientY||innerHeight/2)/innerHeight-.5*16}px)`;
  requestAnimationFrame(anim);
})();

/* SAVE TOKEN */
function saveToken(){ GH.token=document.getElementById("ghToken").value; localStorage.setItem("ghToken",GH.token); syncStatus.textContent="Connected âœ“"; }

/* HEX CHANGE */
const GH={token:localStorage.getItem("ghToken")};
function setDay(color){ if(!selected) return; const k=key(selected);
if(!override && k!==today()) return; if(color===null) delete data[k]; else data[k]=color;
localStorage.setItem(storeKey,JSON.stringify(data)); render();}
</script>
</body>
</html>
