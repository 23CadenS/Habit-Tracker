<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
:root { --size: 80px; }

body {
    margin: 0;
    background: #050505;
    font-family: system-ui;
    color: #ddd;
    overflow-x: hidden;
}

canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
}

#app {
    position: relative;
    z-index: 2;
    max-width: 1400px;
    margin: auto;
    padding: 20px 20px 160px;
    transition: transform 0.2s;
}

#stats {
    text-align: center;
    font-size: 18px;
    margin-bottom: 10px;
}

/* Honeycomb container */
#grid {
    position: relative;
    margin: auto;
}

/* Flat-top regular hexagon */
.hex {
    position: absolute;
    width: var(--size);
    height: calc(var(--size) * 0.866);
    background: #2a2a2a;
    clip-path: polygon(
        25% 0%, 75% 0%,
        100% 50%,
        75% 100%, 25% 100%,
        0% 50%
    );
    border-radius: 12%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: 0.3s;
}

/* Colors */
.hex.green { background:#1f7f50; color:#eafff4; }
.hex.red { background:#7f1f1f; color:#ffe5e5; }
.hex.yellow { background:#7f7320; color:#fff6c8; }

/* Today glow */
.hex.today {
    box-shadow:
        0 0 14px rgba(255,255,255,0.9),
        0 0 40px rgba(255,255,255,0.6);
}

.hex.locked { opacity: 0.6; }

/* Controls */
#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(10,10,10,0.95);
    backdrop-filter: blur(10px);
    padding: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    z-index: 5;
}

button, input {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 14px;
    border-radius: 6px;
}
button:hover { background:#333; }
input[type=number]{width:80px;}
</style>
</head>

<body>
<canvas id="bg"></canvas>

<div id="app">
    <div id="stats">
        Current streak: <span id="cur">0</span> |
        Max streak: <span id="max">0</span>
    </div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>
    <button id="overrideBtn">Override: OFF</button>

    <label>Days
        <input id="daysSlider" type="range" min="14" max="365" value="90">
    </label>
    <input id="daysInput" type="number" min="1" max="365" value="90">
</div>

<script>
/* ---------- Data ---------- */
const storeKey="hexData";
let data=JSON.parse(localStorage.getItem(storeKey)||"{}");
let override=false, selected=null, days=90;

const slider=daysSlider, num=daysInput;

slider.oninput=()=>{days=+slider.value;num.value=days;render();}
num.onchange=()=>{days=Math.min(365,Math.max(1,+num.value||1));slider.value=days;render();}

overrideBtn.onclick=()=>{
    override=!override;
    overrideBtn.innerText=override?"Override: ON":"Override: OFF";
};

function today(){return new Date().toISOString().split("T")[0];}
function datePlus(n){let d=new Date();d.setDate(d.getDate()+n);return d;}
function key(d){return d.toISOString().split("T")[0];}

function setDay(color){
    if(!selected)return;
    const k=key(selected);
    if(!override && k!==today())return;
    data[k]=color;
    localStorage.setItem(storeKey,JSON.stringify(data));
    render();
}

/* ---------- Streaks ---------- */
function calcStreaks(){
    let max=0,cur=0,last=null;
    const keys=Object.keys(data).sort();
    for(const k of keys){
        if(data[k]==="green"){
            if(last){
                const diff=(new Date(k)-new Date(last))/86400000;
                cur=diff===1?cur+1:1;
            } else cur=1;
            max=Math.max(max,cur);
            last=k;
        }
    }
    return {cur: (data[today()]==="green"?cur:0), max};
}

/* ---------- Render ---------- */
function render(){
    const grid=document.getElementById("grid");
    grid.innerHTML="";

    const size=Math.max(38,96-days*0.12);
    document.documentElement.style.setProperty("--size",size+"px");

    const hexW=size;
    const hexH=size*0.866;
    const colSpacing=hexW*0.75;
    const rowSpacing=hexH;

    const cols=Math.round(Math.sqrt(days));
    const rows=Math.ceil(days/cols);

    for(let i=0;i<days;i++){
        const col=Math.floor(i/rows);
        const row=i%rows;

        const x=col*colSpacing;
        const y=row*rowSpacing + (col%2?rowSpacing/2:0);

        const d=datePlus(i);
        const k=key(d);

        const hex=document.createElement("div");
        hex.className="hex";
        if(data[k])hex.classList.add(data[k]);
        if(k===today())hex.classList.add("today");
        if(!override && k!==today())hex.classList.add("locked");

        hex.textContent=d.toLocaleDateString(undefined,{month:"short",day:"numeric"});
        hex.style.left=x+"px";
        hex.style.top=y+"px";

        hex.onclick=()=>{
            selected=d;
            document.querySelectorAll(".hex").forEach(h=>h.style.outline="");
            hex.style.outline="2px solid white";
        };

        grid.appendChild(hex);
    }

    grid.style.width=(cols*colSpacing+hexW)+"px";
    grid.style.height=(rows*rowSpacing+rowSpacing)+"px";

    const s=calcStreaks();
    cur.textContent=s.cur;
    max.textContent=s.max;
}

render();
window.onresize=render;

/* ---------- Mouse parallax ---------- */
document.onmousemove=e=>{
    const x=(e.clientX/window.innerWidth-0.5)*10;
    const y=(e.clientY/window.innerHeight-0.5)*10;
    app.style.transform=`translate(${x}px,${y}px)`;
};

/* ---------- Particles ---------- */
const canvas=document.getElementById("bg"),ctx=canvas.getContext("2d");
let w,h,particles=[];
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight;}
resize();onresize=resize;

for(let i=0;i<120;i++)
    particles.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-0.5)*0.4,vy:(Math.random()-0.5)*0.4,r:Math.random()*2+1});

function loop(){
    ctx.clearRect(0,0,w,h);
    for(const p of particles){
        p.x+=p.vx;p.y+=p.vy;
        if(p.x<0||p.x>w)p.vx*=-1;
        if(p.y<0||p.y>h)p.vy*=-1;
        ctx.fillStyle="rgba(255,255,255,0.1)";
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fill();
    }
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
