<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
:root {
    --size: 86px;
}

body {
    margin: 0;
    background: #060606;
    font-family: system-ui;
    color: #ddd;
    overflow-x: hidden;
}

#app {
    max-width: 1400px;
    margin: auto;
    padding: 20px 20px 160px;
}

#stats {
    text-align: center;
    margin-bottom: 12px;
    font-size: 18px;
}

/* Honeycomb container */
#grid {
    position: relative;
    margin: auto;
}

/* True regular hexagon */
.hex {
    position: absolute;
    width: var(--size);
    height: calc(var(--size) * 1.1547);
    background: #2a2a2a;
    clip-path: polygon(
        50% 0%,
        100% 25%,
        100% 75%,
        50% 100%,
        0% 75%,
        0% 25%
    );
    border-radius: 10%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: 0.3s;
}

/* Colors */
.hex.green { background: #1f7f50; color: #eafff4; }
.hex.red { background: #7f1f1f; color: #ffe5e5; }
.hex.yellow { background: #7f7320; color: #fff6c8; }

/* Today glow */
.hex.today {
    box-shadow:
        0 0 12px rgba(255,255,255,0.9),
        0 0 30px rgba(255,255,255,0.6);
}

/* Locked */
.hex.locked { opacity: 0.6; }

/* Controls */
#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #0d0d0d;
    padding: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    box-shadow: 0 -10px 25px rgba(0,0,0,0.8);
}

button, input {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 14px;
    border-radius: 6px;
}

button:hover { background: #333; }
input[type=number] { width: 80px; }
</style>
</head>

<body>
<div id="app">
    <div id="stats">Max streak: <span id="streak">0</span></div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>
    <button id="overrideBtn">Override: OFF</button>

    <label>Days
        <input id="daysSlider" type="range" min="14" max="365" value="90">
    </label>
    <input id="daysInput" type="number" min="1" max="365" value="90">
</div>

<script>
const storeKey = "hexData";
let data = JSON.parse(localStorage.getItem(storeKey) || "{}");

let override = false;
let selected = null;
let days = 90;

const slider = document.getElementById("daysSlider");
const numberInput = document.getElementById("daysInput");

slider.oninput = () => { days = +slider.value; numberInput.value = days; render(); };
numberInput.onchange = () => {
    days = Math.min(365, Math.max(1, +numberInput.value || 1));
    slider.value = days;
    render();
};

document.getElementById("overrideBtn").onclick = () => {
    override = !override;
    document.getElementById("overrideBtn").innerText = override ? "Override: ON" : "Override: OFF";
};

function today() {
    return new Date().toISOString().split("T")[0];
}

function datePlus(n) {
    const d = new Date();
    d.setDate(d.getDate() + n);
    return d;
}

function key(d) {
    return d.toISOString().split("T")[0];
}

function setDay(color) {
    if (!selected) return;
    const k = key(selected);
    if (!override && k !== today()) return;
    data[k] = color;
    localStorage.setItem(storeKey, JSON.stringify(data));
    render();
}

function calcMaxStreak() {
    let max = 0, cur = 0, last = null;
    Object.keys(data).sort().forEach(k => {
        if (data[k] === "green") {
            if (last) {
                const diff = (new Date(k) - new Date(last)) / 86400000;
                cur = diff === 1 ? cur + 1 : 1;
            } else cur = 1;
            max = Math.max(max, cur);
            last = k;
        }
    });
    return max;
}

function render() {
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    const size = Math.max(38, 96 - days * 0.12);
    document.documentElement.style.setProperty("--size", size + "px");

    const hexW = size;
    const hexH = size * 1.1547;
    const colSpacing = hexW * 0.75;

    const maxRows = Math.floor((window.innerHeight - 260) / hexH);
    const rows = Math.max(6, maxRows);

    for (let i = 0; i < days; i++) {
        const col = Math.floor(i / rows);
        const row = i % rows;

        const x = col * colSpacing;
        const y = row * hexH + (col % 2 ? hexH / 2 : 0);

        const d = datePlus(i);
        const k = key(d);

        const hex = document.createElement("div");
        hex.className = "hex";

        if (data[k]) hex.classList.add(data[k]);
        if (k === today()) hex.classList.add("today");
        if (!override && k !== today()) hex.classList.add("locked");

        hex.textContent = d.toLocaleDateString(undefined, {month:"short", day:"numeric"});

        hex.style.left = x + "px";
        hex.style.top = y + "px";

        hex.onclick = () => {
            selected = d;
            document.querySelectorAll(".hex").forEach(h => h.style.outline = "");
            hex.style.outline = "2px solid white";
        };

        grid.appendChild(hex);
    }

    const totalCols = Math.ceil(days / rows);
    grid.style.width = (totalCols * colSpacing + hexW) + "px";
    grid.style.height = (rows * hexH + hexH) + "px";

    document.getElementById("streak").textContent = calcMaxStreak();
}

render();
window.onresize = render;
</script>
</body>
</html>
