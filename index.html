<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
:root { --hex-size: 86px; }

body {
    margin: 0;
    background: #050505;
    font-family: system-ui, sans-serif;
    color: #ddd;
    overflow-x: hidden;
}

/* PARTICLES */
canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
}

#app {
    position: relative;
    z-index: 2;
    padding: 20px 20px 170px;
    max-width: 1400px;
    margin: auto;
}

#stats {
    text-align: center;
    margin-bottom: 16px;
    font-size: 18px;
}

/* GRID */
#grid {
    position: relative;
    margin: auto;
    transition: transform 0.18s ease-out;
}

/* HEXAGON */
.hex {
    position: absolute;
    width: var(--hex-size);
    height: calc(var(--hex-size) * 0.866);
    background: #2b2b2b;

    /* Rounded flat-top hex */
    clip-path: polygon(
        26% 3%,
        74% 3%,
        97% 50%,
        74% 97%,
        26% 97%,
        3% 50%
    );

    border-radius: 18%;

    /* STRONG GLOW + SEPARATION */
    box-shadow:
        0 0 0 1.4px rgba(255,255,255,0.75),
        0 0 12px rgba(255,255,255,0.55),
        0 0 26px rgba(255,255,255,0.25),
        inset 0 0 10px rgba(255,255,255,0.18);

    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #e0e0e0;
    cursor: pointer;

    transition:
        transform 0.28s ease,
        box-shadow 0.28s ease,
        background 0.28s ease;
}

.hex:hover {
    transform: scale(1.08);
    box-shadow:
        0 0 0 1.6px rgba(255,255,255,1),
        0 0 18px rgba(255,255,255,0.9),
        0 0 42px rgba(255,255,255,0.45),
        inset 0 0 14px rgba(255,255,255,0.25);
}

/* COLORS */
.green {
    background: #1f7f50;
    box-shadow:
        0 0 0 1.6px rgba(220,255,235,1),
        0 0 20px rgba(90,255,200,0.8),
        0 0 44px rgba(60,200,150,0.45);
}
.red {
    background: #7f1f1f;
    box-shadow:
        0 0 0 1.6px rgba(255,220,220,1),
        0 0 20px rgba(255,90,90,0.8),
        0 0 44px rgba(200,60,60,0.45);
}
.yellow {
    background: #7f7320;
    box-shadow:
        0 0 0 1.6px rgba(255,245,200,1),
        0 0 20px rgba(255,230,130,0.85),
        0 0 44px rgba(200,180,70,0.45);
}

/* TODAY â€” VERY STRONG */
.today {
    box-shadow:
        0 0 0 2px white,
        0 0 28px rgba(255,255,255,1),
        0 0 60px rgba(255,255,255,0.85),
        0 0 100px rgba(255,255,255,0.45);
}

/* LOCKED */
.locked { opacity: 0.55; }

/* CONTROLS */
#controls {
    position: fixed;
    bottom: 0;
    inset-inline: 0;
    background: #0d0d0d;
    padding: 14px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.9);
    z-index: 3;
}

button, input {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 14px;
    border-radius: 6px;
    font-size: 14px;
}

button:hover { background: #333; }
input[type=number] { width: 80px; }

#grayBtn { display: none; }
</style>
</head>

<body>

<canvas id="particles"></canvas>

<div id="app">
    <div id="stats">
        Max streak: <span id="maxStreak">0</span> |
        Current streak: <span id="curStreak">0</span>
    </div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>
    <button id="grayBtn" onclick="setDay(null)">Gray</button>

    <button id="overrideBtn">Override: OFF</button>

    <label>Days
        <input id="daysSlider" type="range" min="14" max="500">
    </label>
    <input id="daysInput" type="number" min="1" max="500">
</div>

<script>
/* DATA */
const storeKey="hexData", autoKey="hexAutoDays";
let data=JSON.parse(localStorage.getItem(storeKey)||"{}");
let override=false, selected=null;

/* DATE HELPERS */
const today=()=>new Date().toISOString().split("T")[0];
const datePlus=n=>{const d=new Date();d.setDate(d.getDate()+n);return d;}
const key=d=>d.toISOString().split("T")[0];

/* AUTO DAYS */
function getAutoDays(){
    const t=today();
    let s=JSON.parse(localStorage.getItem(autoKey)||"{}");
    if(!s.date) s={date:t,days:60};
    const diff=(new Date(t)-new Date(s.date))/86400000;
    if(diff>0){s.days+=diff;s.date=t;}
    localStorage.setItem(autoKey,JSON.stringify(s));
    return s.days;
}
let days=getAutoDays();

/* CONTROLS */
daysSlider.value=daysInput.value=days;
daysSlider.oninput=()=>{days=+daysSlider.value;daysInput.value=days;render();}
daysInput.onchange=()=>{days=Math.min(500,Math.max(1,+daysInput.value||1));daysSlider.value=days;render();}

overrideBtn.onclick=()=>{
    override=!override;
    overrideBtn.textContent=override?"Override: ON":"Override: OFF";
    grayBtn.style.display=override?"inline-block":"none";
};

/* SET DAY */
function setDay(color){
    if(!selected) return;
    const k=key(selected);
    if(!override && k!==today()) return;
    if(color===null) delete data[k];
    else data[k]=color;
    localStorage.setItem(storeKey,JSON.stringify(data));
    render();
}

/* STREAKS */
function calcStreaks(){
    let max=0,cur=0,prev=null;
    Object.keys(data).sort().forEach(k=>{
        if(data[k]==="green"){
            cur=prev&&(new Date(k)-new Date(prev)===86400000)?cur+1:1;
            max=Math.max(max,cur); prev=k;
        }
    });
    let run=0;
    for(let i=0;;i--){
        const k=key(datePlus(i));
        if(data[k]==="green") run++; else break;
    }
    return{max,cur:run};
}

/* RENDER */
function render(){
    grid.innerHTML="";
    const size=Math.max(36,96-days*0.12);
    document.documentElement.style.setProperty("--hex-size",size+"px");

    const w=size, h=size*0.866;
    const gap=w*0.78; /* tiny spacing */

    const rows=Math.max(6,Math.floor((innerHeight-260)/h));

    for(let i=0;i<days;i++){
        const col=Math.floor(i/rows), row=i%rows;
        const d=datePlus(i), k=key(d);

        const hex=document.createElement("div");
        hex.className="hex";
        if(data[k]) hex.classList.add(data[k]);
        if(k===today()) hex.classList.add("today");
        if(!override && k!==today()) hex.classList.add("locked");

        hex.textContent=d.toLocaleDateString(undefined,{month:"short",day:"numeric"});
        hex.style.left=(col*gap)+"px";
        hex.style.top=(row*h+(col%2?h/2:0))+"px";
        hex.onclick=()=>selected=d;

        grid.appendChild(hex);
    }

    grid.style.width=(Math.ceil(days/rows)*gap+w)+"px";
    grid.style.height=(rows*h+h)+"px";

    const s=calcStreaks();
    maxStreak.textContent=s.max;
    curStreak.textContent=s.cur;
}
render();
onresize=render;

/* PARTICLES */
const ctx=particles.getContext("2d");
function resize(){particles.width=innerWidth;particles.height=innerHeight;}
resize();onresize=resize;
const parts=[...Array(100)].map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*2+.5,v:Math.random()*.25+.1}));
(function anim(){
    ctx.clearRect(0,0,particles.width,particles.height);
    ctx.fillStyle="rgba(255,255,255,.18)";
    parts.forEach(p=>{p.y-=p.v;if(p.y<0)p.y=particles.height;
        ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();});
    requestAnimationFrame(anim);
})();

/* MOUSE REACT */
addEventListener("mousemove",e=>{
    grid.style.transform=`translate(${(e.clientX/innerWidth-.5)*16}px,${(e.clientY/innerHeight-.5)*16}px)`;
});
</script>

</body>
</html>
