<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
body {
    margin: 0;
    background: #080808;
    font-family: system-ui;
    color: #bbb;
}

#app {
    max-width: 1200px;
    margin: auto;
    padding: 20px 20px 140px;
}

#stats {
    text-align: center;
    margin-bottom: 15px;
    font-size: 18px;
    color: #eee;
}

#grid {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.row {
    display: flex;
    gap: 10px;
}

.row.offset {
    margin-left: 45px;
}

.hex {
    width: var(--w);
    height: calc(var(--w) * 0.58);
    background: #2b2b2b;
    position: relative;
    clip-path: polygon(
        25% 0%, 75% 0%,
        100% 50%,
        75% 100%, 25% 100%,
        0% 50%
    );
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: 0.3s;
}

.hex.green { background: #1f7f50; color: #d9ffef; }
.hex.red { background: #7f1f1f; color: #ffd9d9; }
.hex.yellow { background: #7f7320; color: #fff6b3; }

.hex.today {
    box-shadow: 0 0 12px white;
}

.hex.locked {
    opacity: 0.6;
}

#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #111;
    padding: 14px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

button {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
}

button:hover {
    background: #333;
}

input[type=range] {
    width: 200px;
}
</style>
</head>

<body>
<div id="app">
    <div id="stats">Max streak: <span id="streak">0</span></div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>
    <button onclick="setDay(null)">Clear</button>
    <button id="overrideBtn">Override: OFF</button>

    <label>Days forward
        <input id="daysSlider" type="range" min="7" max="120" value="30">
    </label>
</div>

<script>
const storeKey = "hexData";
let data = JSON.parse(localStorage.getItem(storeKey) || "{}");

let override = false;
let selected = null;
let days = 30;

document.getElementById("daysSlider").oninput = e => {
    days = +e.target.value;
    render();
};

document.getElementById("overrideBtn").onclick = () => {
    override = !override;
    document.getElementById("overrideBtn").innerText = override ? "Override: ON" : "Override: OFF";
};

function today() {
    return new Date().toISOString().split("T")[0];
}

function datePlus(n) {
    const d = new Date();
    d.setDate(d.getDate() + n);
    return d;
}

function key(d) {
    return d.toISOString().split("T")[0];
}

function setDay(color) {
    if (!selected) return;
    const k = key(selected);

    if (!override && k !== today()) return;

    if (color) data[k] = color;
    else delete data[k];

    localStorage.setItem(storeKey, JSON.stringify(data));
    render();
}

function calcMaxStreak() {
    let max = 0, current = 0;
    const keys = Object.keys(data).sort();
    let last = null;

    for (const k of keys) {
        if (data[k] === "green") {
            if (last) {
                const d1 = new Date(last);
                const d2 = new Date(k);
                const diff = (d2 - d1) / 86400000;
                current = diff === 1 ? current + 1 : 1;
            } else current = 1;
            max = Math.max(max, current);
            last = k;
        }
    }
    return max;
}

function render() {
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    const size = 80 - (days * 0.3);
    document.documentElement.style.setProperty("--w", size + "px");

    let index = 0;
    for (let r = 0; index < days; r++) {
        const row = document.createElement("div");
        row.className = "row" + (r % 2 ? " offset" : "");

        for (let c = 0; c < 8 && index < days; c++) {
            const d = datePlus(index);
            const k = key(d);

            const hex = document.createElement("div");
            hex.className = "hex";

            if (data[k]) hex.classList.add(data[k]);
            if (k === today()) hex.classList.add("today");
            if (!override && k !== today()) hex.classList.add("locked");

            hex.innerText = d.toLocaleDateString(undefined, {month:"short", day:"numeric"});

            hex.onclick = () => {
                selected = d;
                document.querySelectorAll(".hex").forEach(h => h.style.outline = "");
                hex.style.outline = "2px solid white";
            };

            row.appendChild(hex);
            index++;
        }

        grid.appendChild(row);
    }

    document.getElementById("streak").innerText = calcMaxStreak();
}

render();
</script>
</body>
</html>
