<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hex Habit Tracker</title>

<style>
:root {
    --size: 84px;
}

body {
    margin: 0;
    background: #050505;
    font-family: system-ui;
    overflow-x: hidden;
    color: #ddd;
}

canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
}

#app {
    position: relative;
    z-index: 2;
    padding: 20px 20px 160px;
    max-width: 1300px;
    margin: auto;
}

#stats {
    text-align: center;
    margin-bottom: 14px;
    font-size: 18px;
}

#grid {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: calc(var(--size) * 0.87);
    justify-content: center;
}

.hex {
    width: var(--size);
    height: calc(var(--size) * 1.1547);
    margin: calc(var(--size) * -0.2887) 0;
    background: #2a2a2a;
    clip-path: polygon(
        50% 0%,
        100% 25%,
        100% 75%,
        50% 100%,
        0% 75%,
        0% 25%
    );
    border-radius: 12%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #aaa;
    cursor: pointer;
    transition: 0.3s;
}


.hex:nth-child(odd) {
    transform: translateY(calc(var(--size) * 0.577));
}

/* States */
.hex.green { background: #1f7f50; color: #eafff4; }
.hex.red { background: #7f1f1f; color: #ffe5e5; }
.hex.yellow { background: #7f7320; color: #fff6c8; }

/* Today glow */
.hex.today {
    box-shadow:
        0 0 12px rgba(255,255,255,0.8),
        0 0 30px rgba(255,255,255,0.5);
}

.hex.locked { opacity: 0.6; }

/* Controls */
#controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(10,10,10,0.95);
    backdrop-filter: blur(10px);
    padding: 14px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    z-index: 5;
}

button, input {
    background: #222;
    border: none;
    color: #ddd;
    padding: 10px 14px;
    border-radius: 6px;
}
button:hover { background:#333; }

input[type=number] { width: 80px; }
</style>
</head>

<body>
<canvas id="bg"></canvas>

<div id="app">
    <div id="stats">Max streak: <span id="streak">0</span></div>
    <div id="grid"></div>
</div>

<div id="controls">
    <button onclick="setDay('green')">Green</button>
    <button onclick="setDay('yellow')">Yellow</button>
    <button onclick="setDay('red')">Red</button>
    <button id="overrideBtn">Override: OFF</button>

    <label>Days
        <input id="daysSlider" type="range" min="14" max="365" value="90">
    </label>
    <input id="daysInput" type="number" min="1" max="365" value="90">
</div>

<script>
/* ---------------- data ---------------- */
const storeKey = "hexData";
let data = JSON.parse(localStorage.getItem(storeKey) || "{}");

let override=false, selected=null, days=90;

const slider = document.getElementById("daysSlider");
const numberInput = document.getElementById("daysInput");

slider.oninput = ()=>{days=+slider.value;numberInput.value=days;render();}
numberInput.onchange=()=>{days=Math.min(365,Math.max(1,+numberInput.value||1));slider.value=days;render();}

document.getElementById("overrideBtn").onclick=()=>{
    override=!override;
    document.getElementById("overrideBtn").innerText=override?"Override: ON":"Override: OFF";
}

function today(){return new Date().toISOString().split("T")[0];}
function datePlus(n){let d=new Date();d.setDate(d.getDate()+n);return d;}
function key(d){return d.toISOString().split("T")[0];}

function setDay(color){
    if(!selected)return;
    const k=key(selected);
    if(!override && k!==today())return;
    data[k]=color;
    localStorage.setItem(storeKey,JSON.stringify(data));
    render();
}

function calcMaxStreak(){
    let max=0,cur=0,last=null;
    Object.keys(data).sort().forEach(k=>{
        if(data[k]==="green"){
            if(last){
                let diff=(new Date(k)-new Date(last))/86400000;
                cur=diff===1?cur+1:1;
            } else cur=1;
            max=Math.max(max,cur);
            last=k;
        }
    });
    return max;
}

/* ---------------- render ---------------- */
function render() {
    const grid = document.getElementById("grid");
    grid.innerHTML = "";

    const size = Math.max(38, 96 - days * 0.15);
    document.documentElement.style.setProperty("--size", size + "px");

    const perColumn = Math.ceil(Math.sqrt(days));

    for (let i = 0; i < days; i++) {
        const d = datePlus(i);
        const k = key(d);

        const hex = document.createElement("div");
        hex.className = "hex";

        if (data[k]) hex.classList.add(data[k]);
        if (k === today()) hex.classList.add("today");
        if (!override && k !== today()) hex.classList.add("locked");

        hex.textContent = d.toLocaleDateString(undefined, {month:"short", day:"numeric"});

        hex.style.gridRow = (i % perColumn) + 1;
        hex.style.gridColumn = Math.floor(i / perColumn) + 1;

        hex.onclick = () => {
            selected = d;
            document.querySelectorAll(".hex").forEach(h => h.style.outline = "");
            hex.style.outline = "2px solid white";
        };

        grid.appendChild(hex);
    }

    document.getElementById("streak").textContent = calcMaxStreak();
}

render();

/* ---------------- particles ---------------- */
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d");
let w,h,mouse={x:0,y:0};
let particles=[];

function resize(){
    w=canvas.width=window.innerWidth;
    h=canvas.height=window.innerHeight;
}
window.onresize=resize;
resize();

for(let i=0;i<120;i++){
    particles.push({
        x:Math.random()*w,
        y:Math.random()*h,
        vx:(Math.random()-0.5)*0.4,
        vy:(Math.random()-0.5)*0.4,
        r:Math.random()*2+1
    });
}

document.onmousemove=e=>{mouse.x=e.clientX;mouse.y=e.clientY;}

function loop(){
    ctx.clearRect(0,0,w,h);
    for(let p of particles){
        p.x+=p.vx;
        p.y+=p.vy;

        if(p.x<0||p.x>w)p.vx*=-1;
        if(p.y<0||p.y>h)p.vy*=-1;

        const dx=p.x-mouse.x;
        const dy=p.y-mouse.y;
        const dist=Math.sqrt(dx*dx+dy*dy);

        const glow=Math.max(0,150-dist)/150;

        ctx.fillStyle=`rgba(255,255,255,${0.08+glow*0.4})`;
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r+glow*3,0,Math.PI*2);
        ctx.fill();
    }
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
